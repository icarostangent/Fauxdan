{
    # Development configuration
    debug
    admin off
    local_certs
    # Allow self-signed certs for development
    skip_install_trust
}

localhost, dev2.icarostangent.lab {
    # Force self-signed certificate
    tls internal

    # Handle django admin requests - more specific to avoid conflicts
    handle /admin {
        reverse_proxy backend:8000
    }
    
    handle /admin/* {
        reverse_proxy backend:8000
    }

    # Handle analytics requests
    handle /analytics/* {
        reverse_proxy backend:8000
    }

    # Handle API requests
    handle /api/* {
        reverse_proxy backend:8000
    }

    # Handle static files - more explicit configuration
    handle /static/* {
        root * /static
        file_server
        try_files {path}
    }

    # Handle frontend requests - only for non-API, non-static paths
    handle {
        reverse_proxy frontend:3000
    }

    # Detailed development logging
    log {
        output stdout
        format console
        level DEBUG
    }
}