{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
    .scanner-dashboard {
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #007cba;
        margin-bottom: 10px;
    }
    
    .stat-label {
        color: #666;
        font-size: 1.1em;
    }
    
    .chart-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    
    .chart-title {
        font-size: 1.3em;
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
        border-bottom: 2px solid #007cba;
        padding-bottom: 10px;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    
    .data-table th,
    .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    
    .data-table th {
        background-color: #f8f9fa;
        font-weight: bold;
        color: #333;
    }
    
    .data-table tr:hover {
        background-color: #f5f5f5;
    }
    
    .metric-highlight {
        color: #28a745;
        font-weight: bold;
    }
    
    .metric-warning {
        color: #ffc107;
        font-weight: bold;
    }
    
    .metric-danger {
        color: #dc3545;
        font-weight: bold;
    }
    
    .metric-info {
        color: #17a2b8;
        font-weight: bold;
    }
    
    .status-running {
        color: #28a745;
        font-weight: bold;
    }
    
    .status-completed {
        color: #007cba;
        font-weight: bold;
    }
    
    .status-failed {
        color: #dc3545;
        font-weight: bold;
    }
    
    .status-pending {
        color: #ffc107;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="scanner-dashboard">
    <h1>üîç Internet Scanner Dashboard</h1>
    <p class="help">Overview of your network scanning operations for the last 30 days</p>
    
    <!-- Scan Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ total_scans }}</div>
            <div class="stat-label">Total Scans</div>
        </div>
        <div class="stat-card">
            <div class="stat-number status-running">{{ active_scans }}</div>
            <div class="stat-label">Active Scans</div>
        </div>
        <div class="stat-card">
            <div class="stat-number status-completed">{{ completed_scans }}</div>
            <div class="stat-label">Completed Scans</div>
        </div>
        <div class="stat-card">
            <div class="stat-number status-failed">{{ failed_scans }}</div>
            <div class="stat-label">Failed Scans</div>
        </div>
    </div>
    
    <!-- Host & Port Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ total_hosts }}</div>
            <div class="stat-label">Total Hosts</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-info">{{ public_hosts }}</div>
            <div class="stat-label">Public Hosts</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-warning">{{ private_hosts }}</div>
            <div class="stat-label">Private Hosts</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-highlight">{{ recent_hosts }}</div>
            <div class="stat-label">Recent Hosts (30d)</div>
        </div>
    </div>
    
    <!-- Network Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ total_ports }}</div>
            <div class="stat-label">Total Ports</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-highlight">{{ open_ports }}</div>
            <div class="stat-label">Open Ports</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-warning">{{ closed_ports }}</div>
            <div class="stat-label">Closed Ports</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-info">{{ tcp_ports }}</div>
            <div class="stat-label">TCP Ports</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-info">{{ udp_ports }}</div>
            <div class="stat-label">UDP Ports</div>
        </div>
    </div>
    
    <!-- Security & Infrastructure -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number metric-highlight">{{ total_ssl_certs }}</div>
            <div class="stat-label">SSL Certificates</div>
        </div>
        <div class="stat-card">
            <div class="stat-number metric-info">{{ total_proxies }}</div>
            <div class="stat-label">Total Proxies</div>
        </div>
        <div class="stat-card">
            <div class="stat-number status-running">{{ active_proxies }}</div>
            <div class="stat-label">Active Proxies</div>
        </div>
        <div class="stat-card">
            <div class="stat-number status-failed">{{ dead_proxies }}</div>
            <div class="stat-label">Dead Proxies</div>
        </div>
    </div>
    
    <!-- Popular Ports -->
    <div class="chart-container">
        <div class="chart-title">üîå Most Common Ports</div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Port</th>
                    <th>Count</th>
                    <th>Common Services</th>
                </tr>
            </thead>
            <tbody>
                {% for port in popular_ports %}
                <tr>
                    <td><code>{{ port.port_number }}</code></td>
                    <td><span class="metric-highlight">{{ port.count }}</span></td>
                    <td>
                        {% if port.port_number == 80 %}HTTP
                        {% elif port.port_number == 443 %}HTTPS
                        {% elif port.port_number == 22 %}SSH
                        {% elif port.port_number == 21 %}FTP
                        {% elif port.port_number == 25 %}SMTP
                        {% elif port.port_number == 53 %}DNS
                        {% elif port.port_number == 3306 %}MySQL
                        {% elif port.port_number == 5432 %}PostgreSQL
                        {% elif port.port_number == 27017 %}MongoDB
                        {% elif port.port_number == 6379 %}Redis
                        {% else %}Unknown
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Scan Types Distribution -->
    <div class="chart-container">
        <div class="chart-title">üìä Scan Types Distribution</div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Scan Type</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody>
                {% for scan_type in scan_types %}
                <tr>
                    <td>{{ scan_type.scan_type|default:"Unknown"|title }}</td>
                    <td><span class="metric-highlight">{{ scan_type.count }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Recent Activity Summary -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="chart-container">
            <div class="chart-title">üÜï Recent Activity (30 days)</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>New Hosts</td>
                        <td><span class="metric-highlight">{{ recent_hosts }}</span></td>
                    </tr>
                    <tr>
                        <td>New SSL Certs</td>
                        <td><span class="metric-highlight">{{ recent_ssl_certs }}</span></td>
                    </tr>
                    <tr>
                        <td>New Domains</td>
                        <td><span class="metric-highlight">{{ recent_domains }}</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="chart-container">
            <div class="chart-title">üìà Growth Metrics</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Host Discovery Rate</td>
                        <td><span class="metric-info">{{ recent_hosts|floatformat:1 }}/day</span></td>
                    </tr>
                    <tr>
                        <td>Port Discovery Rate</td>
                        <td><span class="metric-info">{{ open_ports|floatformat:0 }} open</span></td>
                    </tr>
                    <tr>
                        <td>SSL Coverage</td>
                        <td><span class="metric-highlight">{{ total_ssl_certs|floatformat:0 }} certs</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="chart-container">
        <div class="chart-title">‚ö° Quick Actions</div>
        <p>
            <a href="{% url 'admin:internet_scan_changelist' %}" class="button">View All Scans</a>
            <a href="{% url 'admin:internet_host_changelist' %}" class="button">View All Hosts</a>
            <a href="{% url 'admin:internet_port_changelist' %}" class="button">View All Ports</a>
            <a href="{% url 'admin:internet_proxy_changelist' %}" class="button">View All Proxies</a>
            <a href="{% url 'admin:internet_domain_changelist' %}" class="button">View All Domains</a>
            <a href="{% url 'admin:internet_sslcertificate_changelist' %}" class="button">View All SSL Certs</a>
        </p>
    </div>
    
    <!-- System Information -->
    <div class="chart-container">
        <div class="chart-title">‚ÑπÔ∏è System Information</div>
        <p><strong>Data Period:</strong> {{ start_date|date:"M d, Y" }} to {{ end_date|date:"M d, Y" }}</p>
        <p><strong>Total Records:</strong> {{ total_hosts|add:total_ports|add:total_ssl_certs|add:total_proxies|add:total_domains }} network entities</p>
    </div>
</div>
{% endblock %}
